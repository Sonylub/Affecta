{% extends "base.html" %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - –°—Ç–∞–±–∏–ª{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
                –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            </h1>
            <p class="text-gray-600 dark:text-gray-400 mt-1">
                –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –¥–∏–Ω–∞–º–∏–∫—É
            </p>
        </div>
        
        <!-- –§–∏–ª—å—Ç—Ä—ã –ø–µ—Ä–∏–æ–¥–∞ -->
        <div class="flex items-center space-x-2">
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
                –ü–µ—Ä–∏–æ–¥:
            </label>
            <select id="periodSelect" onchange="changePeriod()" 
                    class="block w-32 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                <option value="7" {% if period == '7' %}selected{% endif %}>7 –¥–Ω–µ–π</option>
                <option value="14" {% if period == '14' %}selected{% endif %}>14 –¥–Ω–µ–π</option>
                <option value="30" {% if period == '30' %}selected{% endif %}>30 –¥–Ω–µ–π</option>
                <option value="90" {% if period == '90' %}selected{% endif %}>90 –¥–Ω–µ–π</option>
                <option value="365" {% if period == '365' %}selected{% endif %}>–ì–æ–¥</option>
            </select>
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl card-shadow text-center">
            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-1">
                {{ stats.mood.mean if stats and stats.mood else '--' }}
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">
                –°—Ä–µ–¥–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
            </div>
        </div>
        
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl card-shadow text-center">
            <div class="text-2xl font-bold text-red-600 dark:text-red-400 mb-1">
                {{ stats.anxiety.mean if stats and stats.anxiety else '--' }}
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">
                –°—Ä–µ–¥–Ω—è—è —Ç—Ä–µ–≤–æ–≥–∞
            </div>
        </div>
        
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl card-shadow text-center">
            <div class="text-2xl font-bold text-green-600 dark:text-green-400 mb-1">
                {{ stats.energy.mean if stats and stats.energy else '--' }}
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">
                –°—Ä–µ–¥–Ω—è—è —ç–Ω–µ—Ä–≥–∏—è
            </div>
        </div>
        
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl card-shadow text-center">
            <div class="text-2xl font-bold text-purple-600 dark:text-purple-400 mb-1">
                {{ stats.sleep_hours.mean|round(1) if stats and stats.sleep_hours else '--' }}
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">
                –°—Ä–µ–¥–Ω–∏–π —Å–æ–Ω (—á–∞—Å—ã)
            </div>
        </div>
    </div>
    
    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                –î–∏–Ω–∞–º–∏–∫–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
            </h3>
            <div class="h-80">
                <canvas id="mainChart"></canvas>
            </div>
        </div>
        
        <!-- –¢–∏–ø—ã –¥–Ω–µ–π -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–Ω–µ–π
            </h3>
            <div class="h-80">
                <canvas id="dayTypeChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </h3>
            
            {% if stats %}
            <div class="space-y-4">
                {% for metric, data in stats.items() %}
                <div class="border-b border-gray-200 dark:border-gray-600 pb-4 last:border-b-0">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2 capitalize">
                        {{ metric.replace('_', ' ') }}
                    </h4>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500 dark:text-gray-400">–°—Ä–µ–¥–Ω–µ–µ:</span>
                            <span class="font-medium text-gray-900 dark:text-white ml-1">
                                {{ data.mean|round(2) }}
                            </span>
                        </div>
                        <div>
                            <span class="text-gray-500 dark:text-gray-400">–ú–∏–Ω:</span>
                            <span class="font-medium text-gray-900 dark:text-white ml-1">
                                {{ data.min }}
                            </span>
                        </div>
                        <div>
                            <span class="text-gray-500 dark:text-gray-400">–ú–∞–∫—Å:</span>
                            <span class="font-medium text-gray-900 dark:text-white ml-1">
                                {{ data.max }}
                            </span>
                        </div>
                    </div>
                    <div class="mt-2">
                        <span class="text-gray-500 dark:text-gray-400">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ:</span>
                        <span class="font-medium text-gray-900 dark:text-white ml-1">
                            {{ data.std|round(2) }}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8">
                <div class="text-4xl mb-2">üìä</div>
                <p class="text-gray-600 dark:text-gray-400">
                    –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                </p>
            </div>
            {% endif %}
        </div>
        
        <!-- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
            </h3>
            
            <div class="space-y-4">
                <p class="text-gray-600 dark:text-gray-400 mb-4">
                    –í—ã –º–æ–∂–µ—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö 
                    –∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É.
                </p>
                
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                    <a href="{{ url_for('export_data', format='csv', period=period) }}" 
                       class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        CSV
                    </a>
                    
                    <a href="{{ url_for('export_data', format='json', period=period) }}" 
                       class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                        </svg>
                        JSON
                    </a>
                    
                    <a href="{{ url_for('export_data', format='pdf', period=period) }}" 
                       class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        PDF
                    </a>
                </div>
                
                <div class="text-xs text-gray-500 dark:text-gray-400">
                    * –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
                </div>
            </div>
        </div>
    </div>
    
    <!-- –¢—Ä–µ–Ω–¥—ã -->
    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
            –í—ã–≤–æ–¥—ã –∏ —Ç—Ä–µ–Ω–¥—ã
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h4 class="font-medium text-gray-900 dark:text-white mb-2">
                    –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã
                </h4>
                <div class="space-y-2">
                    {% if stats and stats.mood and stats.mood.mean >= 6 %}
                    <div class="flex items-center text-green-600 dark:text-green-400">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-sm">–•–æ—Ä–æ—à–µ–µ —Å—Ä–µ–¥–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span>
                    </div>
                    {% endif %}
                    
                    {% if stats and stats.sleep_hours and stats.sleep_hours.mean >= 7 %}
                    <div class="flex items-center text-green-600 dark:text-green-400">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-sm">–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–Ω–∞</span>
                    </div>
                    {% endif %}
                    
                    {% if stats and stats.anxiety and stats.anxiety.mean <= 4 %}
                    <div class="flex items-center text-green-600 dark:text-green-400">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-sm">–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <div>
                <h4 class="font-medium text-gray-900 dark:text-white mb-2">
                    –û–±–ª–∞—Å—Ç–∏ –¥–ª—è –≤–Ω–∏–º–∞–Ω–∏—è
                </h4>
                <div class="space-y-2">
                    {% if stats and stats.mood and stats.mood.mean < 4 %}
                    <div class="flex items-center text-yellow-600 dark:text-yellow-400">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-sm">–ù–∏–∑–∫–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è</span>
                    </div>
                    {% endif %}
                    
                    {% if stats and stats.anxiety and stats.anxiety.mean > 7 %}
                    <div class="flex items-center text-yellow-600 dark:text-yellow-400">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-sm">–í—ã—Å–æ–∫–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å - —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏</span>
                    </div>
                    {% endif %}
                    
                    {% if stats and stats.sleep_hours and stats.sleep_hours.mean < 6 %}
                    <div class="flex items-center text-yellow-600 dark:text-yellow-400">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-sm">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —Å–Ω–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex items-start">
                    <div class="flex-shrink-0 text-blue-600 dark:text-blue-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h4 class="font-medium text-gray-900 dark:text-white">
                            –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–µ–π
                        </h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –¥–µ–ª–∞—Ç—å –∑–∞–ø–∏—Å–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.
                        </p>
                    </div>
                </div>
                
                <div class="flex items-start">
                    <div class="flex-shrink-0 text-purple-600 dark:text-purple-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h4 class="font-medium text-gray-900 dark:text-white">
                            –ü—Å–∏—Ö–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
                        </h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            –ò–∑—É—á–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã" –¥–ª—è —Ç–µ—Ö–Ω–∏–∫ —Å–∞–º–æ–ø–æ–º–æ—â–∏.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // –ì—Ä–∞—Ñ–∏–∫–∏
    document.addEventListener('DOMContentLoaded', function() {
        // –û—Å–Ω–æ–≤–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫
        const mainCtx = document.getElementById('mainChart').getContext('2d');
        
        new Chart(mainCtx, {
            type: 'line',
            data: {
                labels: {{ chart_data.dates|tojson }},
                datasets: [
                    {
                        label: '–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ',
                        data: {{ chart_data.mood|tojson }},
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: false
                    },
                    {
                        label: '–¢—Ä–µ–≤–æ–≥–∞',
                        data: {{ chart_data.anxiety|tojson }},
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: false
                    },
                    {
                        label: '–≠–Ω–µ—Ä–≥–∏—è',
                        data: {{ chart_data.energy|tojson }},
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10
                    }
                }
            }
        });
        
        // –ì—Ä–∞—Ñ–∏–∫ —Ç–∏–ø–æ–≤ –¥–Ω–µ–π
        const dayTypeCtx = document.getElementById('dayTypeChart').getContext('2d');
        
        // –ü–æ–¥—Å—á–µ—Ç —Ç–∏–ø–æ–≤ –¥–Ω–µ–π
        const dayTypes = {{ chart_data.day_type|tojson }};
        const dayTypeCounts = {};
        dayTypes.forEach(type => {
            if (type) {
                dayTypeCounts[type] = (dayTypeCounts[type] || 0) + 1;
            }
        });
        
        const labels = {
            'normal': '–ù–æ—Ä–º–∞–ª—å–Ω—ã–π',
            'manic': '–ú–∞–Ω–∏–∞–∫–∞–ª—å–Ω—ã–π',
            'depressive': '–î–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π',
            'mixed': '–°–º–µ—à–∞–Ω–Ω—ã–π'
        };
        
        const colors = {
            'normal': '#3B82F6',
            'manic': '#F59E0B',
            'depressive': '#6B7280',
            'mixed': '#8B5CF6'
        };
        
        new Chart(dayTypeCtx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(dayTypeCounts).map(key => labels[key] || key),
                datasets: [{
                    data: Object.values(dayTypeCounts),
                    backgroundColor: Object.keys(dayTypeCounts).map(key => colors[key] || '#6B7280')
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    });
    
    // –°–º–µ–Ω–∞ –ø–µ—Ä–∏–æ–¥–∞
    function changePeriod() {
        const period = document.getElementById('periodSelect').value;
        window.location.href = `{{ url_for('analytics') }}?period=${period}`;
    }
    
    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
    setInterval(() => {
        const period = document.getElementById('periodSelect').value;
        window.location.href = `{{ url_for('analytics') }}?period=${period}`;
    }, 300000);
</script>
{% endblock %}