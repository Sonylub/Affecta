{% extends "base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –°—Ç–∞–±–∏–ª{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        </h1>
        <p class="text-gray-600 dark:text-gray-400">
            –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥ —Å–≤–æ–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
        </p>
    </div>
    
    <!-- –¢–∞–±—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="mb-8">
        <div class="flex flex-wrap border-b border-gray-200 dark:border-gray-600">
            <button onclick="switchSettingsTab('profile')" 
                    id="settings-tab-profile"
                    class="px-6 py-3 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-500 transition-colors">
                –ü—Ä–æ—Ñ–∏–ª—å
            </button>
            <button onclick="switchSettingsTab('trackers')" 
                    id="settings-tab-trackers"
                    class="px-6 py-3 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-500 transition-colors">
                –¢—Ä–µ–∫–µ—Ä—ã
            </button>
            <button onclick="switchSettingsTab('medications')" 
                    id="settings-tab-medications"
                    class="px-6 py-3 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-500 transition-colors">
                –ú–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã
            </button>
            <button onclick="switchSettingsTab('notifications')" 
                    id="settings-tab-notifications"
                    class="px-6 py-3 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-500 transition-colors">
                –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            </button>
            <button onclick="switchSettingsTab('privacy')" 
                    id="settings-tab-privacy"
                    class="px-6 py-3 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-500 transition-colors">
                –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
            </button>
        </div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settingsContent">
        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="settings-content-profile" class="settings-content">
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                    –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                </h2>
                
                <form onsubmit="updateProfile(event)" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            </label>
                            <input type="text" name="username" value="{{ current_user.username }}" 
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"
                                   readonly>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Email
                            </label>
                            <input type="email" name="email" value="{{ current_user.email }}" 
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                   required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                –ò–º—è
                            </label>
                            <input type="text" name="first_name" value="{{ current_user.first_name or '' }}" 
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                   placeholder="–í–∞—à–µ –∏–º—è">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                –§–∞–º–∏–ª–∏—è
                            </label>
                            <input type="text" name="last_name" value="{{ current_user.last_name or '' }}" 
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                   placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
                            </label>
                            <input type="date" name="birth_date" 
                                   value="{{ current_user.birth_date.strftime('%Y-%m-%d') if current_user.birth_date else '' }}" 
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å
                            </label>
                            <select name="timezone" 
                                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="UTC" {% if current_user.timezone == 'UTC' %}selected{% endif %}>UTC</option>
                                <option value="Europe/Moscow" {% if current_user.timezone == 'Europe/Moscow' %}selected{% endif %}>
                                    –ú–æ—Å–∫–≤–∞ (UTC+3)
                                </option>
                                <option value="Asia/Yekaterinburg" {% if current_user.timezone == 'Asia/Yekaterinburg' %}selected{% endif %}>
                                    –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ (UTC+5)
                                </option>
                                <option value="Asia/Omsk" {% if current_user.timezone == 'Asia/Omsk' %}selected{% endif %}>
                                    –û–º—Å–∫ (UTC+6)
                                </option>
                                <option value="Asia/Krasnoyarsk" {% if current_user.timezone == 'Asia/Krasnoyarsk' %}selected{% endif %}>
                                    –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫ (UTC+7)
                                </option>
                                <option value="Asia/Irkutsk" {% if current_user.timezone == 'Asia/Irkutsk' %}selected{% endif %}>
                                    –ò—Ä–∫—É—Ç—Å–∫ (UTC+8)
                                </option>
                                <option value="Asia/Yakutsk" {% if current_user.timezone == 'Asia/Yakutsk' %}selected{% endif %}>
                                    –Ø–∫—É—Ç—Å–∫ (UTC+9)
                                </option>
                                <option value="Asia/Vladivostok" {% if current_user.timezone == 'Asia/Vladivostok' %}selected{% endif %}>
                                    –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫ (UTC+10)
                                </option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç—Ä–µ–∫–µ—Ä—ã -->
        <div id="settings-content-trackers" class="settings-content hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
                        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç—Ä–µ–∫–µ—Ä—ã
                    </h2>
                    <button onclick="openAddTrackerModal()" 
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫–µ—Ä
                    </button>
                </div>
                
                <div class="mb-6">
                    <p class="text-gray-600 dark:text-gray-400 mb-4">
                        –°–æ–∑–¥–∞–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è. –≠—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å 
                        –ø—Ä–∏–≤—ã—á–∫–∏, —Å–∏–º–ø—Ç–æ–º—ã –∏–ª–∏ –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ –¥–ª—è –≤–∞—Å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
                    </p>
                </div>
                
                {% if custom_trackers %}
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% for tracker in custom_trackers %}
                        <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="font-medium text-gray-900 dark:text-white">
                                    {{ tracker.name }}
                                </h3>
                                <div class="flex items-center space-x-2">
                                    <div class="w-4 h-4 rounded-full" style="background-color: {{ tracker.color }};"></div>
                                    <span class="text-xs text-gray-500 dark:text-gray-400 uppercase">
                                        {{ tracker.type }}
                                    </span>
                                </div>
                            </div>
                            
                            {% if tracker.description %}
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                                {{ tracker.description }}
                            </p>
                            {% endif %}
                            
                            <div class="flex items-center justify-between">
                                <div class="text-xs text-gray-500 dark:text-gray-400">
                                    {% if tracker.type == 'slider' %}
                                        –î–∏–∞–ø–∞–∑–æ–Ω: {{ tracker.min_value }} - {{ tracker.max_value }}
                                    {% endif %}
                                    {% if tracker.unit %}
                                        ({{ tracker.unit }})
                                    {% endif %}
                                </div>
                                <button onclick="deleteTracker({{ tracker.id }})" 
                                        class="text-red-500 hover:text-red-700 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <div class="text-4xl mb-2">üìä</div>
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
                            –£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç —Ç—Ä–µ–∫–µ—Ä–æ–≤
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">
                            –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫–µ—Ä, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                        </p>
                        <button onclick="openAddTrackerModal()" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                            –°–æ–∑–¥–∞—Ç—å —Ç—Ä–µ–∫–µ—Ä
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- –ú–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã -->
        <div id="settings-content-medications" class="settings-content hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
                        –ú–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã
                    </h2>
                    <button onclick="openAddMedicationModal()" 
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        –î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç
                    </button>
                </div>
                
                {% if medications %}
                    <div class="space-y-4">
                        {% for medication in medications %}
                        <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="font-medium text-gray-900 dark:text-white">
                                    {{ medication.name }}
                                </h3>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">
                                        {{ medication.frequency }}
                                    </span>
                                    <button onclick="deleteMedication({{ medication.id }})" 
                                            class="text-red-500 hover:text-red-700 transition-colors">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                                {{ medication.dosage }}
                            </div>
                            
                            {% if medication.morning or medication.afternoon or medication.evening or medication.night %}
                            <div class="flex flex-wrap gap-2">
                                <span class="text-xs text-gray-500 dark:text-gray-400">–í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞:</span>
                                {% if medication.morning %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">
                                    –£—Ç—Ä–æ
                                </span>
                                {% endif %}
                                {% if medication.afternoon %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300">
                                    –î–µ–Ω—å
                                </span>
                                {% endif %}
                                {% if medication.evening %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
                                    –í–µ—á–µ—Ä
                                </span>
                                {% endif %}
                                {% if medication.night %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">
                                    –ù–æ—á—å
                                </span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <div class="text-4xl mb-2">üíä</div>
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
                            –£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">
                            –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–∏–µ–º
                        </p>
                        <button onclick="openAddMedicationModal()" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                            –î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="settings-content-notifications" class="settings-content hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                    –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                </h2>
                
                <div class="space-y-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-medium text-gray-900 dark:text-white">
                                –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–ø–∏—Å–∏
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                –ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–¥–µ–ª–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –∑–∞–ø–∏—Å—å
                            </p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" name="daily_reminder" value="1" checked
                                   class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:after:border-gray-500 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-medium text-gray-900 dark:text-white">
                                –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞—Ö
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–µ–º–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤
                            </p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" name="medication_reminder" value="1" checked
                                   class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:after:border-gray-500 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-medium text-gray-900 dark:text-white">
                                –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–∏—Å–∫–∞—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
                            </p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" name="alert_notifications" value="1" checked
                                   class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:after:border-gray-500 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            –í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
                        </label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">
                                    –£—Ç—Ä–æ
                                </label>
                                <input type="time" name="morning_time" value="09:00" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">
                                    –î–µ–Ω—å
                                </label>
                                <input type="time" name="afternoon_time" value="15:00" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">
                                    –í–µ—á–µ—Ä
                                </label>
                                <input type="time" name="evening_time" value="21:00" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">
                                    –ù–æ—á—å
                                </label>
                                <input type="time" name="night_time" value="23:00" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm">
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button onclick="saveNotificationSettings()" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å -->
        <div id="settings-content-privacy" class="settings-content hidden">
            <div class="space-y-6">
                <!-- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö -->
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <h3 class="font-medium text-gray-900 dark:text-white mb-2">
                                –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                                –°–∫–∞—á–∞–π—Ç–µ –≤—Å–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è 
                                –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞ –≤ –¥—Ä—É–≥—É—é —Å–∏—Å—Ç–µ–º—É.
                            </p>
                            <button onclick="exportAllData()" 
                                    class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
                            </button>
                        </div>
                        
                        <div>
                            <h3 class="font-medium text-gray-900 dark:text-white mb-2">
                                –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                                –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞.
                            </p>
                            <button onclick="confirmAccountDeletion()" 
                                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 transition-colors">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                                –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å -->
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                        –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-medium text-gray-900 dark:text-white">
                                    –ê–Ω–æ–Ω–∏–º–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
                                </h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    –†–∞–∑—Ä–µ—à–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                                </p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="analytics" value="1" checked
                                       class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:after:border-gray-500 peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-medium text-gray-900 dark:text-white">
                                    –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
                                </h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –≥—Ä—É–ø–ø–æ–≤—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö (–¥–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–Ω–æ–Ω–∏–º–Ω—ã)
                                </p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="corporate_analytics" value="1"
                                       class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:after:border-gray-500 peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                        <h4 class="font-medium text-gray-900 dark:text-white mb-2">
                            –ö–∞–∫ –º—ã –∑–∞—â–∏—â–∞–µ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ
                        </h4>
                        <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                            <li>‚Ä¢ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —à–∏—Ñ—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏</li>
                            <li>‚Ä¢ –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —É –≤–∞—Å –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞</li>
                            <li>‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</li>
                            <li>‚Ä¢ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∑–∞—â–∏—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–µ—Ä–∞ -->
<div id="addTrackerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 max-w-md w-full">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫–µ—Ä
            </h3>
            <button onclick="closeAddTrackerModal()" 
                    class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <form onsubmit="saveNewTracker(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    –ù–∞–∑–≤–∞–Ω–∏–µ
                </label>
                <input type="text" name="name" required
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –£—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    –¢–∏–ø
                </label>
                <select name="type" onchange="updateTrackerForm()" required
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                    <option value="slider">–°–ª–∞–π–¥–µ—Ä (0-10)</option>
                    <option value="checkbox">–ß–µ–∫–±–æ–∫—Å (–¥–∞/–Ω–µ—Ç)</option>
                    <option value="number">–ß–∏—Å–ª–æ</option>
                    <option value="text">–¢–µ–∫—Å—Ç</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    –û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                </label>
                <textarea name="description" rows="3" 
                          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                          placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–∫–µ—Ä–∞..."></textarea>
            </div>
            
            <div id="sliderSettings" class="hidden space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            –ú–∏–Ω–∏–º—É–º
                        </label>
                        <input type="number" name="min_value" value="0" 
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            –ú–∞–∫—Å–∏–º—É–º
                        </label>
                        <input type="number" name="max_value" value="10" 
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    </div>
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                </label>
                <input type="text" name="unit" 
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, —á–∞—Å—ã, –º–∏–Ω—É—Ç—ã, %">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    –¶–≤–µ—Ç
                </label>
                <div class="flex space-x-2">
                    <input type="color" name="color" value="#3B82F6" 
                           class="w-12 h-10 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                    <input type="text" name="color_text" value="#3B82F6" 
                           class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                           placeholder="#3B82F6">
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-600">
                <button type="button" onclick="closeAddTrackerModal()" 
                        class="px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button type="submit" 
                        class="px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                    –°–æ–∑–¥–∞—Ç—å —Ç—Ä–µ–∫–µ—Ä
                </button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞ -->
<div id="addMedicationModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 max-w-md w-full">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                –î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç
            </h3>
            <button onclick="closeAddMedicationModal()" 
                    class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <form onsubmit="saveNewMedication(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    –ù–∞–∑–≤–∞–Ω–∏–µ
                </label>
                <input type="text" name="name" required
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –õ–∞–º–æ—Ç—Ä–∏–¥–∂–∏–Ω">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    –î–æ–∑–∏—Ä–æ–≤–∫–∞
                </label>
                <input type="text" name="dosage" 
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 100 –º–≥">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–∏–µ–º–∞
                </label>
                <select name="frequency" required
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—É...</option>
                    <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                    <option value="twice_daily">–î–≤–∞ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å</option>
                    <option value="three_times_daily">–¢—Ä–∏ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å</option>
                    <option value="weekly">–†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é</option>
                    <option value="as_needed">–ü–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞
                </label>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="checkbox" name="morning" value="1" 
                               class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded">
                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">–£—Ç—Ä–æ–º</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" name="afternoon" value="1" 
                               class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded">
                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">–î–Ω–µ–º</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" name="evening" value="1" 
                               class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded">
                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">–í–µ—á–µ—Ä–æ–º</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" name="night" value="1" 
                               class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded">
                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">–ù–æ—á—å—é</span>
                    </label>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-600">
                <button type="button" onclick="closeAddMedicationModal()" 
                        class="px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button type="submit" 
                        class="px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                    –î–æ–±–∞–≤–∏—Ç—å
                </button>
            </div>
        </form>
    </div>
</div>

{% block scripts %}
<script>
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function switchSettingsTab(tabName) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–Ω—Ç—ã
        document.querySelectorAll('.settings-content').forEach(content => {
            content.classList.add('hidden');
        });
        
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–∞–±–æ–≤
        document.querySelectorAll('[id^="settings-tab-"]').forEach(tab => {
            tab.classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
            tab.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
        document.getElementById(`settings-content-${tabName}`).classList.remove('hidden');
        
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–∞–±
        const activeTab = document.getElementById(`settings-tab-${tabName}`);
        activeTab.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
        activeTab.classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    function updateProfile(event) {
        event.preventDefault();
        
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());
        
        fetch('/api/profile', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω!');
            } else {
                alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: ' + result.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è');
        });
    }
    
    // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —Ç—Ä–µ–∫–µ—Ä–æ–≤
    function openAddTrackerModal() {
        document.getElementById('addTrackerModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    
    function closeAddTrackerModal() {
        document.getElementById('addTrackerModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
        document.getElementById('addTrackerModal').querySelector('form').reset();
        updateTrackerForm();
    }
    
    function updateTrackerForm() {
        const type = document.querySelector('#addTrackerModal select[name="type"]').value;
        const sliderSettings = document.getElementById('sliderSettings');
        
        if (type === 'slider') {
            sliderSettings.classList.remove('hidden');
        } else {
            sliderSettings.classList.add('hidden');
        }
    }
    
    function saveNewTracker(event) {
        event.preventDefault();
        
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());
        
        fetch('/api/custom-trackers', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('–¢—Ä–µ–∫–µ—Ä —Å–æ–∑–¥–∞–Ω!');
                closeAddTrackerModal();
                window.location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–µ–∫–µ—Ä–∞: ' + result.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–µ–∫–µ—Ä–∞');
        });
    }
    
    function deleteTracker(trackerId) {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç—Ä–µ–∫–µ—Ä?')) {
            fetch(`/api/custom-trackers/${trackerId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    window.location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–µ—Ä–∞');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–µ—Ä–∞');
            });
        }
    }
    
    // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤
    function openAddMedicationModal() {
        document.getElementById('addMedicationModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    
    function closeAddMedicationModal() {
        document.getElementById('addMedicationModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
        document.getElementById('addMedicationModal').querySelector('form').reset();
    }
    
    function saveNewMedication(event) {
        event.preventDefault();
        
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());
        
        // –°–æ–±–∏—Ä–∞–µ–º –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞
        data.morning = formData.has('morning');
        data.afternoon = formData.has('afternoon');
        data.evening = formData.has('evening');
        data.night = formData.has('night');
        
        fetch('/api/medications', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('–ú–µ–¥–∏–∫–∞–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω!');
                closeAddMedicationModal();
                window.location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞: ' + result.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞');
        });
    }
    
    function deleteMedication(medicationId) {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç?')) {
            fetch(`/api/medications/${medicationId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    window.location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞');
            });
        }
    }
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function saveNotificationSettings() {
        const notifications = {};
        document.querySelectorAll('input[name^="notification_"]').forEach(input => {
            notifications[input.name] = input.checked;
        });
        
        fetch('/api/notifications/settings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(notifications)
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
        });
    }
    
    // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
    function exportAllData() {
        if (confirm('–í—ã —Ö–æ—Ç–∏—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ?')) {
            window.location.href = '/api/export/all';
        }
    }
    
    // –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
    function confirmAccountDeletion() {
        const confirmation = prompt('–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –≤–≤–µ–¥–∏—Ç–µ "–£–î–ê–õ–ò–¢–¨":');
        if (confirmation === '–£–î–ê–õ–ò–¢–¨') {
            fetch('/api/account', {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('–ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª–µ–Ω. –í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    window.location.href = '/';
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞: ' + result.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞');
            });
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–± –∏–∑ localStorage
        const activeTab = localStorage.getItem('activeSettingsTab') || 'profile';
        switchSettingsTab(activeTab);
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ü–≤–µ—Ç–∞
        document.querySelector('input[name="color"]').addEventListener('input', function() {
            document.querySelector('input[name="color_text"]').value = this.value;
        });
        
        document.querySelector('input[name="color_text"]').addEventListener('input', function() {
            document.querySelector('input[name="color"]').value = this.value;
        });
    });
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–∞–±–∞
    document.addEventListener('click', function(e) {
        if (e.target.matches('[id^="settings-tab-"]')) {
            const tabName = e.target.id.replace('settings-tab-', '');
            localStorage.setItem('activeSettingsTab', tabName);
        }
    });
</script>
{% endblock %}