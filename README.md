# Affecta - Биполярный трекер

Веб-приложение для отслеживания состояния и настроения при биполярном расстройстве.

## Описание

Affecta позволяет пользователям вести ежедневные записи о состоянии, отслеживать приём лекарств, анализировать динамику через графики и статистику, а также автоматически определять фазы биполярного расстройства и генерировать PDF отчёты для врачей.

## Основной функционал

- **Ежедневные записи**: состояния (депрессивное, маниакальное, раздражительность, тревога), сон, лекарства, пользовательские состояния, заметки
- **Автоматическое определение фаз**: нормальный, депрессивный, гипоманиакальный, смешанный
- **Дашборд**: графики истории фаз, статистика сна, детальная аналитика
- **PDF отчёты**: генерация отчётов с графиками и статистикой
- **Управление данными**: лекарства, пользовательские состояния, кастомные трекеры

## Технологический стек

- **Backend**: Flask, Flask-Login, PyMySQL, bcrypt
- **Frontend**: HTML5, Tailwind CSS, JavaScript, Chart.js
- **База данных**: MySQL
- **Генерация отчётов**: reportlab, matplotlib

## Установка

1. **Установка зависимостей**
```bash
pip install -r requirements.txt
```

2. **Настройка базы данных**
   - Создайте базу данных MySQL
   - Выполните SQL-скрипт: `mysql -u root -p < database/init_db.sql`

3. **Настройка переменных окружения**
   Создайте файл `.env`:
   ```env
   SECRET_KEY=your-secret-key-here
   DB_HOST=localhost
   DB_USER=root
   DB_PASS=your-password
   DB_NAME=Treker
   DB_PORT=3306
   ```

4. **Запуск**
```bash
python app.py
```

Приложение доступно по адресу: `http://localhost:5000`

## Структура проекта

```
Affecta/
├── app.py                 # Главный файл приложения Flask
├── models.py              # Модели базы данных
├── routes.py              # Маршруты и API endpoints
├── report_generator.py    # Генератор PDF отчётов
├── requirements.txt       # Зависимости
│
├── database/
│   └── init_db.sql        # SQL-скрипт инициализации БД
│
├── templates/             # HTML шаблоны
└── static/                # CSS, JS, изображения
```

## База данных

Основные таблицы:
- `users` — пользователи
- `entries` — ежедневные записи
- `medications` — лекарства
- `med_intakes` — отметки о приёме лекарств
- `custom_states` — пользовательские состояния
- `custom_state_values` — значения состояний
- `custom_trackers` — кастомные трекеры
- `custom_values` — значения трекеров

## API Endpoints

- `POST /save_entry` — сохранение записи
- `GET /get_entry/<date>` — получение записи
- `POST /add_medication` — добавление лекарства
- `POST /add_custom_state` — добавление состояния
- `GET /get_dashboard_data` — данные для дашборда
- `GET /get_analytics_data` — данные для аналитики
- `GET /generate_report` — генерация PDF отчёта

## Безопасность

- Пароли хешируются через bcrypt
- Защита от SQL-инъекций через параметризованные запросы
- Flask-Login для управления сессиями
- Валидация всех пользовательских данных

---

Проект разработан для образовательных целей.
